D:\anaconda3\envs\base-normal\python.exe D:\日事日清周度汇总系统\本地运行版\build_image.py 

==> docker build -t rishiriqing-local:latest . (cwd=D:\日事日清周度汇总系统\本地运行版)
#0 building with "desktop-linux" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 809B done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/library/node:18-alpine
#2 DONE 2.6s

#3 [internal] load .dockerignore
#3 transferring context: 188B done
#3 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 417.58kB 0.0s done
#4 DONE 0.0s

#5 [build  1/11] FROM docker.io/library/node:18-alpine@sha256:8d6421d663b4c28fd3ebc498332f249011d118945588d0a35cb9bc4b8ca09d9e
#5 resolve docker.io/library/node:18-alpine@sha256:8d6421d663b4c28fd3ebc498332f249011d118945588d0a35cb9bc4b8ca09d9e 0.0s done
#5 sha256:1e5a4c89cee5c0826c540ab06d4b6b491c96eda01837f430bd47f0d26702d6e3 0B / 1.26MB 0.1s
#5 sha256:8d6421d663b4c28fd3ebc498332f249011d118945588d0a35cb9bc4b8ca09d9e 7.67kB / 7.67kB done
#5 sha256:929b04d7c782f04f615cf785488fed452b6569f87c73ff666ad553a7554f0006 1.72kB / 1.72kB done
#5 sha256:ee77c6cd7c1886ecc802ad6cedef3a8ec1ea27d1fb96162bf03dd3710839b8da 6.18kB / 6.18kB done
#5 sha256:f18232174bc91741fdf3da96d85011092101a032a93a388b79e99e69c2d5c870 0B / 3.64MB 0.1s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 0B / 40.01MB 0.1s
#5 sha256:f18232174bc91741fdf3da96d85011092101a032a93a388b79e99e69c2d5c870 1.05MB / 3.64MB 1.2s
#5 sha256:f18232174bc91741fdf3da96d85011092101a032a93a388b79e99e69c2d5c870 2.10MB / 3.64MB 1.4s
#5 sha256:f18232174bc91741fdf3da96d85011092101a032a93a388b79e99e69c2d5c870 3.15MB / 3.64MB 1.7s
#5 extracting sha256:f18232174bc91741fdf3da96d85011092101a032a93a388b79e99e69c2d5c870
#5 sha256:f18232174bc91741fdf3da96d85011092101a032a93a388b79e99e69c2d5c870 3.64MB / 3.64MB 1.7s done
#5 extracting sha256:f18232174bc91741fdf3da96d85011092101a032a93a388b79e99e69c2d5c870 0.1s done
#5 sha256:25ff2da83641908f65c3a74d80409d6b1b62ccfaab220b9ea70b80df5a2e0549 0B / 446B 1.9s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 3.15MB / 40.01MB 3.3s
#5 sha256:25ff2da83641908f65c3a74d80409d6b1b62ccfaab220b9ea70b80df5a2e0549 446B / 446B 3.2s done
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 5.24MB / 40.01MB 3.5s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 7.34MB / 40.01MB 3.8s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 9.44MB / 40.01MB 4.0s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 11.53MB / 40.01MB 4.4s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 13.63MB / 40.01MB 4.7s
#5 sha256:1e5a4c89cee5c0826c540ab06d4b6b491c96eda01837f430bd47f0d26702d6e3 0B / 1.26MB 5.2s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 15.73MB / 40.01MB 5.2s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 17.83MB / 40.01MB 5.6s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 19.92MB / 40.01MB 6.0s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 22.02MB / 40.01MB 6.6s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 24.12MB / 40.01MB 6.9s
#5 sha256:1e5a4c89cee5c0826c540ab06d4b6b491c96eda01837f430bd47f0d26702d6e3 1.05MB / 1.26MB 7.5s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 27.26MB / 40.01MB 7.5s
#5 sha256:1e5a4c89cee5c0826c540ab06d4b6b491c96eda01837f430bd47f0d26702d6e3 1.26MB / 1.26MB 7.9s done
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 29.36MB / 40.01MB 8.1s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 31.46MB / 40.01MB 8.5s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 33.55MB / 40.01MB 8.9s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 35.65MB / 40.01MB 9.2s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 37.75MB / 40.01MB 9.7s
#5 sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 40.01MB / 40.01MB 10.0s done
#5 extracting sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e
#5 extracting sha256:dd71dde834b5c203d162902e6b8994cb2309ae049a0eabc4efea161b2b5a3d0e 0.8s done
#5 extracting sha256:1e5a4c89cee5c0826c540ab06d4b6b491c96eda01837f430bd47f0d26702d6e3 0.0s done
#5 extracting sha256:25ff2da83641908f65c3a74d80409d6b1b62ccfaab220b9ea70b80df5a2e0549 done
#5 DONE 11.0s

#6 [build  2/11] WORKDIR /app
#6 DONE 0.1s

#7 [build  3/11] COPY package.json ./
#7 DONE 0.0s

#8 [build  4/11] RUN npm install
#8 15.22 
#8 15.22 added 100 packages, and audited 101 packages in 15s
#8 15.22 
#8 15.22 13 packages are looking for funding
#8 15.22   run `npm fund` for details
#8 15.23 
#8 15.23 10 vulnerabilities (5 low, 1 moderate, 4 high)
#8 15.23 
#8 15.23 To address issues that do not require attention, run:
#8 15.23   npm audit fix
#8 15.23 
#8 15.23 To address all issues possible, run:
#8 15.23   npm audit fix --force
#8 15.23 
#8 15.23 Some issues need review, and may require choosing
#8 15.23 a different dependency.
#8 15.23 
#8 15.23 Run `npm audit` for details.
#8 15.23 npm notice
#8 15.23 npm notice New major version of npm available! 10.8.2 -> 11.6.1
#8 15.23 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.1
#8 15.23 npm notice To update run: npm install -g npm@11.6.1
#8 15.23 npm notice
#8 DONE 15.3s

#9 [build  5/11] COPY web/package.json web/package.json
#9 DONE 0.0s

#10 [build  6/11] RUN npm install --prefix web
#10 34.83 npm warn EBADENGINE Unsupported engine {
#10 34.83 npm warn EBADENGINE   package: '@vitejs/plugin-vue@6.0.1',
#10 34.83 npm warn EBADENGINE   required: { node: '^20.19.0 || >=22.12.0' },
#10 34.83 npm warn EBADENGINE   current: { node: 'v18.20.8', npm: '10.8.2' }
#10 34.83 npm warn EBADENGINE }
#10 34.83 npm warn EBADENGINE Unsupported engine {
#10 34.83 npm warn EBADENGINE   package: 'vite@7.1.9',
#10 34.83 npm warn EBADENGINE   required: { node: '^20.19.0 || >=22.12.0' },
#10 34.83 npm warn EBADENGINE   current: { node: 'v18.20.8', npm: '10.8.2' }
#10 34.83 npm warn EBADENGINE }
#10 89.18
#10 89.18 added 71 packages, and audited 73 packages in 1m
#10 89.18
#10 89.18 11 packages are looking for funding
#10 89.18   run `npm fund` for details
#10 89.18
#10 89.18 found 0 vulnerabilities
#10 DONE 89.3s

#11 [build  7/11] COPY server ./server
#11 DONE 0.0s

#12 [build  8/11] COPY shared ./shared
#12 DONE 0.0s

#13 [build  9/11] COPY web ./web
#13 DONE 0.0s

#14 [build 10/11] RUN npm run build --prefix web
#14 0.426
#14 0.426 > web@0.0.0 build
#14 0.426 > vue-tsc -b && vite build
#14 0.426
#14 2.948 You are using Node.js 18.20.8. Vite requires Node.js version 20.19+ or 22.12+. Please upgrade your Node.js version.
#14 3.111 vite v7.1.9 building for production...
#14 3.213 transforming...
#14 3.248 ✓ 3 modules transformed.
#14 3.254 ✗ Build failed in 120ms
#14 3.254 error during build:
#14 3.254 [vite:vue] crypto.hash is not a function
#14 3.254 file: /app/web/src/App.vue
#14 3.254     at getHash (file:///app/web/node_modules/@vitejs/plugin-vue/dist/index.js:140:16)
#14 3.254     at createDescriptor (file:///app/web/node_modules/@vitejs/plugin-vue/dist/index.js:89:23)
#14 3.254     at transformMain (file:///app/web/node_modules/@vitejs/plugin-vue/dist/index.js:1633:33)
#14 3.254     at Object.handler (file:///app/web/node_modules/@vitejs/plugin-vue/dist/index.js:2045:27)
#14 3.254     at Object.handler (file:///app/web/node_modules/vite/dist/node/chunks/dep-Chhhsdoe.js:34086:13)
#14 3.254     at file:///app/web/node_modules/rollup/dist/es/shared/node-entry.js:22426:40
#14 ERROR: process "/bin/sh -c npm run build --prefix web" did not complete successfully: exit code: 1
------
 > [build 10/11] RUN npm run build --prefix web:
3.254 ✗ Build failed in 120ms
3.254 error during build:
3.254 [vite:vue] crypto.hash is not a function
3.254 file: /app/web/src/App.vue
3.254     at getHash (file:///app/web/node_modules/@vitejs/plugin-vue/dist/index.js:140:16)
3.254     at createDescriptor (file:///app/web/node_modules/@vitejs/plugin-vue/dist/index.js:89:23)
3.254     at transformMain (file:///app/web/node_modules/@vitejs/plugin-vue/dist/index.js:1633:33)
3.254     at Object.handler (file:///app/web/node_modules/@vitejs/plugin-vue/dist/index.js:2045:27)
3.254     at Object.handler (file:///app/web/node_modules/vite/dist/node/chunks/dep-Chhhsdoe.js:34086:13)
3.254     at file:///app/web/node_modules/rollup/dist/es/shared/node-entry.js:22426:40
------
Dockerfile:17
--------------------
  15 |     COPY web ./web
  16 |
  17 | >>> RUN npm run build --prefix web
  18 |     RUN npm prune --omit=dev
  19 |
--------------------
ERROR: failed to solve: process "/bin/sh -c npm run build --prefix web" did not complete successfully: exit code: 1
Traceback (most recent call last):
  File "D:\日事日清周度汇总系统\本地运行版\build_image.py", line 100, in <module>
    raise SystemExit(main())
  File "D:\日事日清周度汇总系统\本地运行版\build_image.py", line 81, in main
    run(cmd)
  File "D:\日事日清周度汇总系统\本地运行版\build_image.py", line 40, in run
    subprocess.run(cmd, cwd=ROOT, check=True)
  File "D:\anaconda3\envs\base-normal\lib\subprocess.py", line 526, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '['docker', 'build', '-t', 'rishiriqing-local:latest', '.']' returned non-zero exit status 1.
[ERROR] 构建失败，请检查上面的 docker 输出。若 Docker Desktop 未启动，请先启动后重试。

进程已结束，退出代码为 1
